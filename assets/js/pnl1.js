document.addEventListener("DOMContentLoaded",(()=>{const e={areaNumber:document.getElementById("area-number"),nomeBlue:document.getElementById("nomeAtl-blue"),nomeRed:document.getElementById("nomeAtl-red"),liveClock:document.getElementById("live-clock"),mainTimer:document.getElementById("main-timer"),startStopBtn:document.getElementById("start-stop-btn"),resetTimerBtn:document.getElementById("reset-timer-btn"),resetScoreboardBtn:document.getElementById("reset-scoreboard-btn"),fightTimeInput:document.getElementById("fight-time"),scoreButtons:document.querySelectorAll(".btn-plus, .btn-minus"),shiro:{ippon:document.getElementById("shiro-ippon"),wazaari:document.getElementById("shiro-wazaari"),points:document.getElementById("shiro-points"),penalties:{hansoku:[document.getElementById("phblue1"),document.getElementById("phblue2"),document.getElementById("phblue3")],jogai:[document.getElementById("joblue1"),document.getElementById("joblue2"),document.getElementById("joblue3")],mubobi:[document.getElementById("mublue1"),document.getElementById("mublue2"),document.getElementById("mublue3")]}},aka:{ippon:document.getElementById("aka-ippon"),wazaari:document.getElementById("aka-wazaari"),points:document.getElementById("aka-points"),penalties:{hansoku:[document.getElementById("phred1"),document.getElementById("phred2"),document.getElementById("phred3")],jogai:[document.getElementById("jored1"),document.getElementById("jored2"),document.getElementById("jored3")],mubobi:[document.getElementById("mured1"),document.getElementById("mured2"),document.getElementById("mured3")]}},allPenaltyCheckboxes:document.querySelectorAll('.penalties input[type="checkbox"]'),kumiteEspelhoBtn:document.getElementById("gerar-kumite")};let t=null;let n=a(e.fightTimeInput.value);function o(){const n={area:e.areaNumber.value,timer:e.mainTimer.textContent,corTimer:t,aka:{nome:e.nomeRed.value||"Atleta 2",pontos:e.aka.points.textContent,penalties:{hansoku:[e.aka.penalties.hansoku[0].checked,e.aka.penalties.hansoku[1].checked,e.aka.penalties.hansoku[2].checked],jogai:[e.aka.penalties.jogai[0].checked,e.aka.penalties.jogai[1].checked,e.aka.penalties.jogai[2].checked],mubobi:[e.aka.penalties.mubobi[0].checked,e.aka.penalties.mubobi[1].checked,e.aka.penalties.mubobi[2].checked]}},shiro:{nome:e.nomeBlue.value||"Atleta 1",pontos:e.shiro.points.textContent,penalties:{hansoku:[e.shiro.penalties.hansoku[0].checked,e.shiro.penalties.hansoku[1].checked,e.shiro.penalties.hansoku[2].checked],jogai:[e.shiro.penalties.jogai[0].checked,e.shiro.penalties.jogai[1].checked,e.shiro.penalties.jogai[2].checked],mubobi:[e.shiro.penalties.mubobi[0].checked,e.shiro.penalties.mubobi[1].checked,e.shiro.penalties.mubobi[2].checked]}}};localStorage.setItem("karatePlacarState",JSON.stringify(n))}function a(e){if(!e.includes(":"))return parseInt(e,10)||0;const[t,n]=e.split(":").map(Number);return t*60+n}function i(e){const t=Math.floor(e/60);const n=e%60;return`${t}:${n<10?"0":""}${n}`}function l(){e.liveClock.textContent=(new Date).toLocaleTimeString("pt-BR")}function s(){e.mainTimer.textContent=i(n);o()}function c(){if(t){clearInterval(t);t=null;e.startStopBtn.textContent="INICIAR";e.startStopBtn.classList.remove("running")}else{e.startStopBtn.textContent="PAUSAR";e.startStopBtn.classList.add("running");t=setInterval((()=>{if(n>0){n--;e.mainTimer.style.display="flex";e.fightTimeInput.style.display="none";s()}else{clearInterval(t);t=null;e.startStopBtn.textContent="INICIAR";e.startStopBtn.classList.remove("running")}}),1e3)}}function m(t){const n=parseInt(e[t].ippon.textContent,10);const a=parseInt(e[t].wazaari.textContent,10);const i=n*2+a*1;e[t].points.textContent=i;o()}function d(t){const n=t.target.dataset.target;const[o,a]=n.split("-");const i=e[o][a];let l=parseInt(i.textContent,10);if(t.target.classList.contains("btn-plus")){l++}else if(t.target.classList.contains("btn-minus")&&l>0){l--}i.textContent=l;m(o)}function r(){if(t){clearInterval(t);t=null;e.startStopBtn.textContent="INICIAR";e.startStopBtn.classList.remove("running")}n=a(e.fightTimeInput.value);e.mainTimer.style.display="none";e.fightTimeInput.style.display="flex";s()}function u(){["shiro","aka"].forEach((t=>{e[t].ippon.textContent="0";e[t].wazaari.textContent="0";m(t)}));e.nomeBlue.value="";e.nomeRed.value="";e.allPenaltyCheckboxes.forEach((e=>e.checked=false));r();o()}const p=()=>{window.open("placar_fight.html","placarEspelhoKumite")};e.startStopBtn.addEventListener("click",c);e.resetTimerBtn.addEventListener("click",r);e.resetScoreboardBtn.addEventListener("click",u);e.scoreButtons.forEach((e=>e.addEventListener("click",d)));e.fightTimeInput.addEventListener("change",r);e.kumiteEspelhoBtn.addEventListener("click",p);e.nomeRed.addEventListener("input",o);e.nomeBlue.addEventListener("input",o);e.areaNumber.addEventListener("input",o);e.allPenaltyCheckboxes.forEach((e=>{e.addEventListener("change",o)}));setInterval(l,1e3);l();s();m("shiro");m("aka");o()}));