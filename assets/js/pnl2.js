document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("gerar-linhas");const e=document.getElementById("limpar-tabela");const o=document.getElementById("exportar-txt");const a=document.getElementById("quantidade-atletas");const n=document.getElementById("categoria");const l=document.getElementById("tabela-container");const c=()=>{const t=parseInt(a.value)||0;const e=n.value;if(e===""){n.style.backgroundColor="#fcba03";n.focus();alert("Insira o nome da Categoria.");return}else{n.style.backgroundColor="#f1f1f1"}if(t<=0){alert("Por favor, insira uma quantidade válida de atletas.");return}l.innerHTML="";const o=document.createElement("table");o.innerHTML=`\n            <thead>\n                <tr>\n                    <th>Atleta</th>\n                    <th>Nota 1</th>\n                    <th>Nota 2</th>\n                    <th>Nota 3</th>\n                    <th>Nota 4</th>\n                    <th>Nota 5</th>\n                    <th>Total</th>\n                    <th>Colocação</th>\n                </tr>\n            </thead>\n            <tbody>\n            </tbody>\n        `;const c=o.querySelector("tbody");for(let e=0;e<t;e++){const t=document.createElement("tr");t.innerHTML=`\n                \n                <td><input type="text" class="atleta-nome" placeholder="Nome do Atleta"></td>\n                <td><input type="number" class="nota-input" min="0" max="10" step="0.1"></td>\n                <td><input type="number" class="nota-input" min="0" max="10" step="0.1"></td>\n                <td><input type="number" class="nota-input" min="0" max="10" step="0.1"></td>\n                <td><input type="number" class="nota-input" min="0" max="10" step="0.1"></td>\n                <td><input type="number" class="nota-input" min="0" max="10" step="0.1"></td>\n                <td class="total-cell">0.0</td>\n                <td class="placement-cell"></td>\n            `;c.appendChild(t)}l.appendChild(o)};const s=()=>{const t=l.querySelectorAll("tbody tr");const e=[];t.forEach(((t,o)=>{const a=t.querySelectorAll(".nota-input");const n=[];a.forEach((t=>{n.push(parseFloat(t.value)||0);t.classList.remove("discarded-note");m()}));if(n.filter((t=>t>0)).length>=3){const l=[...n].sort(((t,e)=>t-e));const c=l[0];const s=l[l.length-1];const r=n.reduce(((t,e)=>t+e),0)-c-s;t.querySelector(".total-cell").textContent=r.toFixed(1);let d=false;let i=false;a.forEach((t=>{const e=parseFloat(t.value)||0;if(e===c&&!d){t.classList.add("discarded-note");d=true}if(e===s&&!i){t.classList.add("discarded-note");i=true}}));e.push({index:o,total:r})}else{t.querySelector(".total-cell").textContent="0.0";e.push({index:o,total:0})}}));e.sort(((t,e)=>e.total-t.total));e.forEach(((e,o)=>{const a=t[e.index];const n=a.querySelector(".placement-cell");n.textContent=o+1;n.classList.remove("gold","silver","bronze");if(e.total>0){if(o===0)n.classList.add("gold");else if(o===1)n.classList.add("silver");else if(o===2)n.classList.add("bronze")}else{n.textContent="-"}}));m()};const r=()=>{l.innerHTML="";a.value="1";n.value="";m()};const d=()=>{const t=l.querySelectorAll("tbody tr");if(t.length===0){alert("Não há dados para exportar.");return}let e=`Relatório da Categoria: ${n.value||"Não especificada"}\n`;e+="===========================================================\n";e+="Colocação\tAtleta\t\tNota 1\tNota 2\tNota 3\tNota 4\tNota 5\tTotal\n";e+="-----------------------------------------------------------\n";const o=[];t.forEach((t=>{const e=t.querySelector(".atleta-nome").value||"S/ Nome";const a=Array.from(t.querySelectorAll(".nota-input")).map((t=>t.value||"0"));const n=t.querySelector(".total-cell").textContent;const l=t.querySelector(".placement-cell").textContent;o.push({colocacao:l,atletaNome:e,notas:a,total:n})}));o.sort(((t,e)=>t.colocacao-e.colocacao));o.forEach((t=>{e+=`${t.colocacao}\t\t${t.atletaNome.padEnd(10)}\t${t.notas.join("\t")}\t${t.total}\n`}));const a=new Blob([e],{type:"text/plain;charset=utf-8"});const c=document.createElement("a");c.href=URL.createObjectURL(a);c.download=`resultado_${(n.value||"competicao").replace(/\s+/g,"_")}.txt`;c.click()};t.addEventListener("click",c);e.addEventListener("click",r);o.addEventListener("click",d);l.addEventListener("input",(t=>{if(t.target.classList.contains("nota-input")){s()}}));const i=document.getElementById("gerar-espelho");const u=()=>{window.open("placar_final.html","placarEspelho")};if(t){t.addEventListener("click",(()=>{p()}))}else{console.error('Botão com id "meuBotao" não encontrado!')}const p=()=>{const t=l.querySelectorAll("tbody tr");if(t.length===0){alert("Não há dados para gerar a página espelho.");console.log("rows");return}const e=n.value||"Categoria Não Definida";const o=[];i.addEventListener("click",u);t.forEach((t=>{const e=t.querySelector(".atleta-nome").value||"NOME DO ATLETA";const a=parseFloat(t.querySelector(".total-cell").textContent)||0;const n=parseInt(t.querySelector(".placement-cell").textContent)||0;const l=t.querySelectorAll(".nota-input");const c=Array.from(l).map((t=>parseFloat(t.value)||0));let s=[];if(c.filter((t=>t>0)).length>=3){const t=[...c].sort(((t,e)=>t-e));const e=t[0];const o=t[t.length-1];const a=c.indexOf(e);const n=c.lastIndexOf(o);s=c.filter(((t,e)=>e!==a&&e!==n))}if(n>0){o.push({nome:e,total:a,colocacao:n,notasValidas:s})}}));const a={categoria:e,atletas:o};localStorage.setItem("dadosPlacarFinal",JSON.stringify(a))};i.addEventListener("click",p);const m=()=>{const t=l.querySelectorAll("tbody tr");const e=n.value||"Categoria Não Definida";const o=[];t.forEach((t=>{const e=t.querySelector(".atleta-nome").value;const a=parseFloat(t.querySelector(".total-cell").textContent)||0;const n=parseInt(t.querySelector(".placement-cell").textContent)||0;const l=t.querySelectorAll(".nota-input");const c=Array.from(l).map((t=>parseFloat(t.value)||0));let s=[];if(c.filter((t=>t>0)).length>=3){const t=[...c].sort(((t,e)=>t-e));s=t.slice(1,-1)}if(n>0){o.push({nome:e,total:a,colocacao:n,notasValidas:s})}}));const a={categoria:e,atletas:o,timestamp:(new Date).getTime()};localStorage.setItem("dadosPlacarFinal",JSON.stringify(a))}}));